summary: Test udisks2 snap installation was successful

execute: |
    . $TESTSLIB/utilities.sh

    # Service should be up and running
    wait_for_systemd_service snap.udisks2.udisksd

    # .. so should ciborium
    wait_for_systemd_service snap.udisks2.ciborium

    # .. and udisksctl should be able to reach udisksd
    /snap/bin/udisks2.udisksctl status

    # Ensure all necessary plugs/slots are connected
    snap interfaces | grep -Pzq ":mount-observe +udisks2"
    snap interfaces | grep -Pzq "udisks2:service +udisks2:client"
    snap interfaces | grep -Pzq ":network-bind +udisks2"

    # Check that automount is disabled by default
    snap get udisks2 automount.enable | grep "false"
    test ! -e /var/snap/udisks2/common/.automount_enabled

    # Check that enabling automount DTRT
    snap set udisks2 automount.enable=true
    snap get udisks2 automount.enable | grep "true"
    test -e /var/snap/udisks2/common/.automount_enabled

    # And for disabling
    snap set udisks2 automount.enable=false
    snap get udisks2 automount.enable | grep "false"
    test ! -e /var/snap/udisks2/common/.automount_enabled
